[{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/App.tsx","messages":[{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":18,"column":17,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":18,"endColumn":28},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":19,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":19,"endColumn":58},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .sessions on an `any` value.","line":19,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":19,"endColumn":52},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":40,"column":12,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":40,"endColumn":17,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[1357,1362],"text":"(saved != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[1357,1362],"text":"(saved ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[1357,1362],"text":"(Boolean(saved))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":130,"column":13,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":130,"endColumn":83,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[4082,4082],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[4082,4082],"text":"await "},"desc":"Add await operator."}]},{"ruleId":"ts/no-unsafe-argument","severity":2,"message":"Unsafe argument of type `any` assigned to a parameter of type `string | number | boolean`.","line":130,"column":53,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":130,"endColumn":57},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .id on an `any` value.","line":130,"column":55,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":57},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":130,"column":73,"nodeType":"Property","messageId":"anyAssignment","endLine":130,"endColumn":78},{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":134,"column":15,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":134,"endColumn":28,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[4253,4253],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[4253,4253],"text":"await "},"desc":"Add await operator."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button, Empty, Layout } from 'antd'\nimport React, { useCallback, useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Route, Routes, useLocation, useNavigate, useParams } from 'react-router-dom'\nimport useSWR from 'swr'\n\nimport { Chat } from '#~/components/Chat'\nimport { Sidebar } from '#~/components/Sidebar'\nimport type {Session} from '@vibe-forge/core';\n\nconst MIN_SIDEBAR_WIDTH = 200\nconst MAX_SIDEBAR_WIDTH = 600\nconst DEFAULT_SIDEBAR_WIDTH = 300\n\nfunction ChatView({ renderLeftHeader }: { renderLeftHeader?: React.ReactNode }) {\n  const { t } = useTranslation()\n  const { sessionId } = useParams()\n  const { data: sessionsRes } = useSWR('/api/sessions')\n  const sessions: Session[] = sessionsRes?.sessions ?? []\n  const session = sessions.find(s => s.id === sessionId)\n\n  if (!session) {\n    return (\n      <div style={{ height: '100%', display: 'grid', placeItems: 'center' }}>\n        <Empty description={t('common.sessionNotFound')} />\n      </div>\n    )\n  }\n\n  return <Chat session={session} renderLeftHeader={renderLeftHeader} />\n}\n\nexport default function App() {\n  const { t } = useTranslation()\n  const navigate = useNavigate()\n  const location = useLocation()\n\n  const [sidebarWidth, setSidebarWidth] = useState(() => {\n    const saved = localStorage.getItem('sidebarWidth')\n    return saved ? Number.parseInt(saved, 10) : DEFAULT_SIDEBAR_WIDTH\n  })\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(() => {\n    return localStorage.getItem('sidebarCollapsed') === 'true'\n  })\n  const [isResizing, setIsResizing] = useState(false)\n  const sidebarRef = useRef<HTMLDivElement>(null)\n\n  const activeId = location.pathname.split('/session/')[1]\n\n  const handleMouseDown = useCallback((e: React.MouseEvent) => {\n    setIsResizing(true)\n    e.preventDefault()\n  }, [])\n\n  const handleMouseMove = useCallback((e: MouseEvent) => {\n    if (!isResizing) return\n\n    let newWidth = e.clientX\n    if (newWidth < MIN_SIDEBAR_WIDTH) newWidth = MIN_SIDEBAR_WIDTH\n    if (newWidth > MAX_SIDEBAR_WIDTH) newWidth = MAX_SIDEBAR_WIDTH\n\n    setSidebarWidth(newWidth)\n    localStorage.setItem('sidebarWidth', newWidth.toString())\n  }, [isResizing])\n\n  const handleMouseUp = useCallback(() => {\n    setIsResizing(false)\n  }, [])\n\n  useEffect(() => {\n    if (isResizing) {\n      window.addEventListener('mousemove', handleMouseMove)\n      window.addEventListener('mouseup', handleMouseUp)\n      document.body.style.cursor = 'col-resize'\n    } else {\n      window.removeEventListener('mousemove', handleMouseMove)\n      window.removeEventListener('mouseup', handleMouseUp)\n      document.body.style.cursor = ''\n    }\n    return () => {\n      window.removeEventListener('mousemove', handleMouseMove)\n      window.removeEventListener('mouseup', handleMouseUp)\n    }\n  }, [isResizing, handleMouseMove, handleMouseUp])\n\n  const toggleSidebar = () => {\n    setIsSidebarCollapsed(prev => {\n      const newState = !prev\n      localStorage.setItem('sidebarCollapsed', newState.toString())\n      return newState\n    })\n  }\n\n  const toggleButton = (\n    <Button\n      type='text'\n      size='small'\n      onClick={toggleSidebar}\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        width: '24px',\n        height: '24px',\n        padding: 0,\n        color: '#6b7280',\n        backgroundColor: 'transparent',\n        border: '1px solid #e5e7eb',\n        borderRadius: '4px'\n      }}\n      title={t('common.expand')}\n    >\n      <span\n        className='material-symbols-outlined'\n        style={{ fontSize: 18, display: 'inline-flex', alignItems: 'center', lineHeight: 1 }}\n      >\n        side_navigation\n      </span>\n    </Button>\n  )\n\n  return (\n    <Layout style={{ height: '100%', position: 'relative', overflow: 'hidden' }}>\n      <div style={{ display: 'flex', height: '100%', width: '100%' }}>\n        <Sidebar\n          width={sidebarWidth}\n          collapsed={isSidebarCollapsed}\n          activeId={activeId}\n          onSelectSession={(s, isNew) => {\n            navigate(`/session/${encodeURIComponent(s.id)}`, { state: { isNew } })\n          }}\n          onDeletedSession={(id) => {\n            if (activeId === id) {\n              navigate('/')\n            }\n          }}\n          onToggleCollapse={toggleSidebar}\n        />\n\n        <div\n          onMouseDown={handleMouseDown}\n          style={{\n            width: isSidebarCollapsed ? 0 : '4px',\n            cursor: isSidebarCollapsed ? 'default' : 'col-resize',\n            backgroundColor: isResizing ? '#3b82f6' : 'transparent',\n            zIndex: 10,\n            transition: 'background-color 0.2s, width 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n            flexShrink: 0,\n            position: 'relative',\n            marginLeft: isSidebarCollapsed ? 0 : '-2px',\n            marginRight: isSidebarCollapsed ? 0 : '-2px',\n            pointerEvents: isSidebarCollapsed ? 'none' : 'auto',\n            overflow: 'hidden'\n          }}\n          title={t('common.dragResize')}\n        />\n\n        <Layout.Content style={{ flex: 1, position: 'relative', overflow: 'hidden' }}>\n          <Routes>\n            <Route\n              path='/session/:sessionId'\n              element={<ChatView renderLeftHeader={isSidebarCollapsed ? toggleButton : null} />}\n            />\n            <Route\n              path='/'\n              element={\n                <div style={{ height: '100%', position: 'relative' }}>\n                  {isSidebarCollapsed && (\n                    <div style={{ position: 'absolute', left: '16px', top: '16px', zIndex: 10 }}>\n                      {toggleButton}\n                    </div>\n                  )}\n                  <div style={{ height: '100%', display: 'grid', placeItems: 'center' }}>\n                    <Empty description={t('common.selectOrCreateSession')} />\n                  </div>\n                </div>\n              }\n            />\n          </Routes>\n        </Layout.Content>\n      </div>\n    </Layout>\n  )\n}\n\n/* no-op */\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/api.ts","messages":[{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":7,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":7,"endColumn":20},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":16,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":16,"endColumn":20},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":21,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":21,"endColumn":20},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":30,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":30,"endColumn":20},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":35,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":35,"endColumn":20},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":40,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":40,"endColumn":14,"suggestions":[{"fix":{"range":[1149,1192],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":47,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":47,"endColumn":20},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `Promise<any>`.","line":56,"column":3,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":56,"endColumn":20}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const SERVER_HOST = import.meta.env.VITE_SERVER_HOST || window.location.hostname\nconst SERVER_PORT = import.meta.env.VITE_SERVER_PORT || '8787'\nconst SERVER_URL = `http://${SERVER_HOST}:${SERVER_PORT}`\n\nexport async function listProjects() {\n  const res = await fetch(`${SERVER_URL}/api/projects`)\n  return res.json()\n}\n\nexport async function createProject(name?: string) {\n  const res = await fetch(`${SERVER_URL}/api/projects`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ name })\n  })\n  return res.json()\n}\n\nexport async function listSessions() {\n  const res = await fetch(`${SERVER_URL}/api/sessions`)\n  return res.json()\n}\n\nexport async function createSession(title?: string) {\n  const res = await fetch(`${SERVER_URL}/api/sessions`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ title })\n  })\n  return res.json()\n}\n\nexport async function getConfig() {\n  const res = await fetch(`${SERVER_URL}/api/config`)\n  return res.json()\n}\n\nexport async function deleteSession(id: string) {\n  const url = `${SERVER_URL}/api/sessions/${id}`\n  console.log('[api] deleting session:', url)\n  const res = await fetch(url, { method: 'DELETE' })\n  if (!res.ok) {\n    const text = await res.text()\n    console.error('[api] delete failed:', res.status, text)\n    throw new Error(`Delete failed: ${res.status} ${text}`)\n  }\n  return res.json()\n}\n\nexport async function updateSessionTitle(id: string, title: string) {\n  const res = await fetch(`${SERVER_URL}/api/sessions/${id}`, {\n    method: 'PATCH',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ title })\n  })\n  return res.json()\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/Chat.tsx","messages":[{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":75,"column":10,"nodeType":"ChainExpression","messageId":"conditionErrorNullableString","endLine":75,"endColumn":21,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2441,2453],"text":"(session?.id) == null"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2442,2453],"text":"((session?.id) ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2441,2453],"text":"!Boolean((session?.id))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":86,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":146,"endColumn":36},{"ruleId":"ts/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":86,"column":18,"nodeType":"Identifier","messageId":"unsafeCall","endLine":86,"endColumn":30},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":92,"column":11,"nodeType":"MemberExpression","messageId":"limited","endLine":92,"endColumn":22,"suggestions":[{"fix":{"range":[2824,2880],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":110,"column":15,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":110,"endColumn":38,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[3599,3599],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[3599,3599],"text":"await "},"desc":"Add await operator."}]},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":148,"column":7,"nodeType":"AssignmentExpression","messageId":"anyAssignment","endLine":148,"endColumn":25},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":195,"column":16,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":195,"endColumn":19},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":197,"column":52,"nodeType":"MemberExpression","messageId":"conditionErrorObject","endLine":197,"endColumn":71}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './Chat.scss'\n\nimport { message } from 'antd'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useSWRConfig } from 'swr'\n\nimport { createSocket } from '#~/ws'\nimport type { ChatMessage, Session, SessionInfo, WSEvent } from '@vibe-forge/core'\n\nimport { ChatHeader } from './chat/ChatHeader'\nimport { CurrentTodoList } from './chat/CurrentTodoList'\nimport { MessageItem } from './chat/MessageItem'\nimport { Sender } from './chat/Sender'\n\nexport function Chat({\n  session,\n  renderLeftHeader\n}: {\n  session?: Session\n  renderLeftHeader?: React.ReactNode\n}) {\n  const [messages, setMessages] = useState<ChatMessage[]>([])\n  const [sessionInfo, setSessionInfo] = useState<SessionInfo | null>(null)\n  const [isThinking, setIsThinking] = useState(false)\n  const [isReady, setIsReady] = useState(false)\n  const wsRef = useRef<WebSocket | null>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const messagesContainerRef = useRef<HTMLDivElement>(null)\n  const wasAtBottom = useRef<boolean>(true)\n  const isInitialLoadRef = useRef<boolean>(true)\n  const [showScrollBottom, setShowScrollBottom] = useState(false)\n  const { mutate } = useSWRConfig()\n\n  const scrollToBottom = (behavior: ScrollBehavior = 'smooth') => {\n    setTimeout(() => {\n      if (messagesContainerRef.current) {\n        messagesContainerRef.current.scrollTo({\n          top: messagesContainerRef.current.scrollHeight,\n          behavior\n        })\n      }\n    }, 50)\n  }\n\n  useEffect(() => {\n    const container = messagesContainerRef.current\n    if (!container) return\n\n    const handleScroll = () => {\n      const { scrollTop, scrollHeight, clientHeight } = container\n      const atBottom = scrollHeight - scrollTop <= clientHeight + 100\n      wasAtBottom.current = atBottom\n      setShowScrollBottom(!atBottom && scrollHeight > clientHeight)\n    }\n\n    container.addEventListener('scroll', handleScroll)\n    return () => container.removeEventListener('scroll', handleScroll)\n  }, [])\n\n  useEffect(() => {\n    if (isInitialLoadRef.current && messages.length > 0) {\n      scrollToBottom('auto')\n      // Small delay to ensure rendering is complete before showing\n      const timer = setTimeout(() => {\n        setIsReady(true)\n        isInitialLoadRef.current = false\n      }, 50)\n      return () => clearTimeout(timer)\n    } else if (wasAtBottom.current) {\n      scrollToBottom('smooth')\n    }\n  }, [messages])\n\n  useEffect(() => {\n    if (!session?.id) return\n\n    setMessages([])\n    setSessionInfo(null)\n    setIsReady(false)\n    isInitialLoadRef.current = true\n\n    let isDisposed = false\n    const timer = setTimeout(() => {\n      if (isDisposed) return\n\n      const ws = createSocket({\n        onOpen() {\n          // Connected\n        },\n        onMessage(data: WSEvent) {\n          if (isDisposed) return\n          console.log('[Chat] Received message:', data.type, data)\n          if (data.type === 'error') {\n            message.error(data.message)\n            setIsThinking(false)\n          } else if (data.type === 'message') {\n            if (data.message.role === 'assistant') {\n              setIsThinking(false)\n            }\n            setMessages((m) => {\n              const exists = m.find((msg) => msg.id === data.message.id)\n              if (exists) {\n                return m.map((msg) => (msg.id === data.message.id ? data.message : msg))\n              }\n              return [...m, data.message]\n            })\n          } else if (data.type === 'session_info') {\n            if (data.info?.type === 'summary') {\n              // 触发 SWR 重新加载侧边栏会话列表，以显示最新标题\n              mutate('/api/sessions')\n            } else {\n              setSessionInfo(data.info)\n              // If it's a new session with no messages, ready it\n              if (isInitialLoadRef.current) {\n                setTimeout(() => {\n                  if (isInitialLoadRef.current) {\n                    setIsReady(true)\n                    isInitialLoadRef.current = false\n                  }\n                }, 100)\n              }\n            }\n          } else if (data.type === 'tool_result') {\n            setIsThinking(false)\n            setMessages((m) => {\n              return m.map((msg) => {\n                if (msg.toolCall && msg.toolCall.id === data.toolCallId) {\n                  return {\n                    ...msg,\n                    toolCall: {\n                      ...msg.toolCall,\n                      status: data.isError ? 'error' : 'success',\n                      output: data.output\n                    }\n                  }\n                }\n                return msg\n              })\n            })\n          }\n        },\n        onClose() {\n          if (isDisposed) return\n          setIsThinking(false)\n        }\n      }, { sessionId: session.id })\n\n      wsRef.current = ws\n    }, 100)\n\n    return () => {\n      isDisposed = true\n      clearTimeout(timer)\n      if (wsRef.current) {\n        wsRef.current.close()\n        wsRef.current = null\n      }\n    }\n  }, [session?.id])\n\n  const send = (text: string) => {\n    if (!wsRef.current || !text.trim() || isThinking) return\n\n    setIsThinking(true)\n    wsRef.current.send(JSON.stringify({\n      type: 'user_message',\n      text: text.trim()\n    }))\n  }\n\n  const interrupt = () => {\n    if (!wsRef.current || !isThinking) return\n    wsRef.current.send(JSON.stringify({\n      type: 'interrupt'\n    }))\n    setIsThinking(false)\n  }\n\n  const clearMessages = () => {\n    setMessages([])\n    message.success('Messages cleared')\n  }\n\n  return (\n    <div className='chat-container'>\n      <ChatHeader\n        sessionInfo={sessionInfo}\n        sessionId={session?.id}\n        sessionTitle={session?.title}\n        renderLeft={renderLeftHeader}\n      />\n\n      <div className={`chat-messages ${isReady ? 'ready' : ''}`} ref={messagesContainerRef}>\n        {messages.map((msg, index) => {\n          if (!msg) return null\n          try {\n            const isFirstInGroup = index === 0 || (messages[index - 1] && messages[index - 1].role !== msg.role)\n            return (\n              <MessageItem\n                key={msg.id || index}\n                msg={msg}\n                isFirstInGroup={isFirstInGroup}\n                allMessages={messages}\n                index={index}\n              />\n            )\n          } catch (err) {\n            console.error('[Chat] Error rendering message:', err, msg)\n            return null\n          }\n        })}\n        <div ref={messagesEndRef} />\n\n        {showScrollBottom && (\n          <div className='scroll-bottom-btn' onClick={() => scrollToBottom()}>\n            <span className='material-symbols-outlined'>arrow_downward</span>\n          </div>\n        )}\n      </div>\n\n      <CurrentTodoList messages={messages} />\n      <Sender\n        onSend={send}\n        isThinking={isThinking}\n        onInterrupt={interrupt}\n        onClear={clearMessages}\n        sessionInfo={sessionInfo}\n      />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/Sidebar.tsx","messages":[{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":34,"column":17,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":34,"endColumn":28},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":37,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":37,"endColumn":58},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .sessions on an `any` value.","line":37,"column":44,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":37,"endColumn":52},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":43,"column":8,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":43,"endColumn":15,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[1297,1304],"text":"(s.title != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[1297,1304],"text":"(s.title ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[1297,1304],"text":"(Boolean(s.title))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an error typed value.","line":49,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":49,"endColumn":46},{"ruleId":"ts/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":49,"column":31,"nodeType":"Identifier","messageId":"unsafeCall","endLine":49,"endColumn":44},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected any value in conditional. An explicit comparison or type conversion is required.","line":51,"column":9,"nodeType":"Identifier","messageId":"conditionErrorAny","endLine":51,"endColumn":16,"suggestions":[{"messageId":"conditionFixCastBoolean","fix":{"range":[1545,1552],"text":"Boolean(session)"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-unsafe-argument","severity":2,"message":"Unsafe argument of type error typed assigned to a parameter of type `Session`.","line":52,"column":23,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":52,"endColumn":30},{"ruleId":"ts/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":58,"column":13,"nodeType":"Identifier","messageId":"unsafeCall","endLine":58,"endColumn":26},{"ruleId":"ts/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type error.","line":80,"column":59,"nodeType":"CallExpression","messageId":"unsafeReturn","endLine":80,"endColumn":76},{"ruleId":"ts/no-unsafe-call","severity":2,"message":"Unsafe call of a(n) `error` type typed value.","line":80,"column":59,"nodeType":"Identifier","messageId":"unsafeCall","endLine":80,"endColumn":72},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to property where a void return was expected.","line":101,"column":7,"nodeType":null,"messageId":"voidReturnProperty","endLine":101,"endColumn":22},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to property where a void return was expected.","line":106,"column":7,"nodeType":null,"messageId":"voidReturnProperty","endLine":106,"endColumn":22},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to attribute where a void return was expected.","line":136,"column":27,"nodeType":"JSXExpressionContainer","messageId":"voidReturnAttribute","endLine":136,"endColumn":48},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to attribute where a void return was expected.","line":143,"column":25,"nodeType":"JSXExpressionContainer","messageId":"voidReturnAttribute","endLine":143,"endColumn":44},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to attribute where a void return was expected.","line":151,"column":27,"nodeType":"JSXExpressionContainer","messageId":"voidReturnAttribute","endLine":151,"endColumn":48}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './Sidebar.scss'\n\nimport { Button, Dropdown } from 'antd'\nimport type { MenuProps } from 'antd'\nimport React, { useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport useSWR from 'swr'\n\nimport { createSession, deleteSession } from '#~/api'\nimport type { Session } from '@vibe-forge/core'\nimport { SessionList } from './sidebar/SessionList'\nimport { SidebarHeader } from './sidebar/SidebarHeader'\n\nexport function Sidebar({\n  activeId,\n  onSelectSession,\n  onDeletedSession,\n  width,\n  collapsed,\n  onToggleCollapse\n}: {\n  activeId?: string\n  onSelectSession: (session: Session, isNew?: boolean) => void\n  onDeletedSession?: (id: string) => void\n  width: number\n  collapsed: boolean\n  onToggleCollapse: () => void\n}) {\n  const { t, i18n } = useTranslation()\n  const [searchQuery, setSearchQuery] = useState('')\n  const [isBatchMode, setIsBatchMode] = useState(false)\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n\n  const { data: sessionsRes, mutate: mutateSessions } = useSWR(\n    `/api/sessions`\n  )\n  const sessions: Session[] = sessionsRes?.sessions ?? []\n\n  const filteredSessions = useMemo(() => {\n    if (!searchQuery.trim()) return sessions\n    const query = searchQuery.toLowerCase()\n    return sessions.filter(s =>\n      (s.title || '').toLowerCase().includes(query)\n      || s.id.toLowerCase().includes(query)\n    )\n  }, [sessions, searchQuery])\n\n  async function handleCreateSession() {\n    const { session } = await createSession()\n    await mutateSessions()\n    if (session) {\n      onSelectSession(session, true)\n    }\n  }\n\n  async function handleDeleteSession(id: string) {\n    try {\n      await deleteSession(id)\n      await mutateSessions()\n      onDeletedSession?.(id)\n    } catch (err) {\n      console.error('Failed to delete session:', err)\n    }\n  }\n\n  const handleToggleSelect = (id: string) => {\n    setSelectedIds(prev => {\n      const next = new Set(prev)\n      if (next.has(id)) {\n        next.delete(id)\n      } else {\n        next.add(id)\n      }\n      return next\n    })\n  }\n\n  const handleBatchDelete = async () => {\n    try {\n      await Promise.all(Array.from(selectedIds).map(id => deleteSession(id)))\n      await mutateSessions()\n      selectedIds.forEach(id => {\n        if (activeId === id) onDeletedSession?.(id)\n      })\n      setSelectedIds(new Set())\n      setIsBatchMode(false)\n    } catch (err) {\n      console.error('Failed to batch delete sessions:', err)\n    }\n  }\n\n  const toggleBatchMode = () => {\n    setIsBatchMode(prev => !prev)\n    setSelectedIds(new Set())\n  }\n\n  const langItems: MenuProps['items'] = [\n    {\n      key: 'zh',\n      label: '简体中文',\n      onClick: async () => i18n.changeLanguage('zh')\n    },\n    {\n      key: 'en',\n      label: 'English',\n      onClick: async () => i18n.changeLanguage('en')\n    }\n  ]\n\n  return (\n    <div\n      className={`sidebar-container ${collapsed ? 'collapsed' : ''}`}\n      style={{\n        width: collapsed ? 0 : width,\n        minWidth: collapsed ? 0 : undefined,\n        overflow: 'hidden',\n        transition: 'width 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n        height: '100%',\n        borderRight: collapsed ? 'none' : '1px solid #f0f0f0',\n        backgroundColor: '#fff',\n        position: 'relative',\n        flexShrink: 0\n      }}\n    >\n      <div\n        style={{\n          width,\n          height: '100%',\n          display: 'flex',\n          flexDirection: 'column',\n          transition: 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\n          transform: collapsed ? `translateX(-${width}px)` : 'translateX(0)'\n        }}\n      >\n        <SidebarHeader\n          onCreateSession={handleCreateSession}\n          onToggleCollapse={onToggleCollapse}\n          searchQuery={searchQuery}\n          onSearchChange={setSearchQuery}\n          isBatchMode={isBatchMode}\n          onToggleBatchMode={toggleBatchMode}\n          selectedCount={selectedIds.size}\n          onBatchDelete={handleBatchDelete}\n        />\n        <SessionList\n          sessions={filteredSessions}\n          activeId={activeId}\n          isBatchMode={isBatchMode}\n          selectedIds={selectedIds}\n          onSelectSession={onSelectSession}\n          onDeleteSession={handleDeleteSession}\n          onToggleSelect={handleToggleSelect}\n        />\n        <div className='sidebar-footer'>\n          <Dropdown menu={{ items: langItems }} placement='topRight' trigger={['click']}>\n            <Button\n              type='text'\n              icon={\n                <span\n                  className='material-symbols-outlined'\n                  style={{ fontSize: 18, lineHeight: '18px', display: 'block' }}\n                >\n                  language\n                </span>\n              }\n              style={{\n                height: 32,\n                width: 32,\n                padding: 0,\n                display: 'inline-flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                color: '#6b7280',\n                borderRadius: 4,\n                margin: '8px'\n              }}\n            />\n          </Dropdown>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/ChatHeader.tsx","messages":[{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":25,"column":18,"nodeType":"ConditionalExpression","messageId":"conditionErrorNullableString","endLine":25,"endColumn":73,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[692,747],"text":"(sessionInfo?.type === 'init' ? sessionInfo.title : null) != null"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[692,747],"text":"(sessionInfo?.type === 'init' ? sessionInfo.title : null) ?? \"\""},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[692,747],"text":"Boolean((sessionInfo?.type === 'init' ? sessionInfo.title : null))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":27,"column":24,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":27,"endColumn":29,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[856,861],"text":"(title != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[856,861],"text":"(title ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[856,861],"text":"(Boolean(title))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":30,"column":9,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":30,"endColumn":14,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[914,919],"text":"title != null"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[914,919],"text":"title ?? \"\""},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[914,919],"text":"Boolean(title)"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":36,"column":10,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":36,"endColumn":19,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[1020,1030],"text":"(sessionId == null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[1021,1030],"text":"(sessionId ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[1020,1030],"text":"(!Boolean(sessionId))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to attribute where a void return was expected.","line":64,"column":24,"nodeType":"JSXExpressionContainer","messageId":"voidReturnAttribute","endLine":64,"endColumn":43},{"ruleId":"ts/no-misused-promises","severity":2,"message":"Promise-returning function provided to attribute where a void return was expected.","line":65,"column":30,"nodeType":"JSXExpressionContainer","messageId":"voidReturnAttribute","endLine":65,"endColumn":49},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":74,"column":32,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":74,"endColumn":41,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2189,2198],"text":"(sessionId != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2189,2198],"text":"(sessionId ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2189,2198],"text":"(Boolean(sessionId))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":75,"column":34,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":75,"endColumn":43,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2255,2264],"text":"(sessionId != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2255,2264],"text":"(sessionId ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2255,2264],"text":"(Boolean(sessionId))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":76,"column":24,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":76,"endColumn":33,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2315,2324],"text":"(sessionId != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2315,2324],"text":"(sessionId ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2315,2324],"text":"(Boolean(sessionId))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":82,"column":14,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":82,"endColumn":17,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2512,2515],"text":"(cwd != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2512,2515],"text":"(cwd ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2512,2515],"text":"(Boolean(cwd))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":87,"column":8,"nodeType":"Identifier","messageId":"conditionErrorNullableString","endLine":87,"endColumn":17,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[2595,2604],"text":"(sessionId != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[2595,2604],"text":"(sessionId ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[2595,2604],"text":"(Boolean(sessionId))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":91,"column":13,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":91,"endColumn":53,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[2713,2713],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[2713,2713],"text":"await "},"desc":"Add await operator."}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":93,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":93,"endColumn":24,"suggestions":[{"fix":{"range":[2816,2969],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './ChatHeader.scss'\nimport type { SessionInfo } from '@vibe-forge/core'\nimport { Input, message } from 'antd'\nimport React, { useEffect, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useSWRConfig } from 'swr'\nimport { updateSessionTitle } from '../../api'\n\nexport function ChatHeader({\n  sessionInfo,\n  sessionId,\n  sessionTitle,\n  renderLeft\n}: {\n  sessionInfo: SessionInfo | null\n  sessionId?: string\n  sessionTitle?: string\n  renderLeft?: React.ReactNode\n}) {\n  const { t } = useTranslation()\n  const { mutate } = useSWRConfig()\n  const [isEditing, setIsEditing] = useState(false)\n  const [editTitle, setEditTitle] = useState('')\n\n  const title = (sessionInfo?.type === 'init' ? sessionInfo.title : null) || sessionTitle\n  const cwd = sessionInfo?.type === 'init' ? sessionInfo.cwd : null\n  const displayTitle = title || t('common.newChat')\n\n  useEffect(() => {\n    if (title) {\n      setEditTitle(title)\n    }\n  }, [title])\n\n  const handleTitleSubmit = async () => {\n    if (!sessionId || !editTitle.trim() || editTitle === title) {\n      setIsEditing(false)\n      return\n    }\n\n    try {\n      await updateSessionTitle(sessionId, editTitle.trim())\n      await mutate('/api/sessions')\n      setIsEditing(false)\n      message.success(t('chat.titleUpdated'))\n    } catch (err) {\n      message.error(t('chat.titleUpdateFailed'))\n    }\n  }\n\n  return (\n    <div className='chat-header'>\n      <div style={{ display: 'flex', alignItems: 'center', gap: '12px', flex: 1, minWidth: 0 }}>\n        {renderLeft}\n        <div\n          className='chat-header-info'\n          style={{ flex: 1, minWidth: 0 }}\n        >\n          {isEditing\n            ? (\n              <Input\n                value={editTitle}\n                onChange={e => setEditTitle(e.target.value)}\n                onBlur={handleTitleSubmit}\n                onPressEnter={handleTitleSubmit}\n                autoFocus\n                size='small'\n                style={{ fontSize: '16px', fontWeight: 600, width: '100%', maxWidth: '400px' }}\n              />\n            )\n            : (\n              <div\n                className='chat-header-title'\n                onClick={() => sessionId && setIsEditing(true)}\n                style={{ cursor: sessionId ? 'pointer' : 'default' }}\n                title={sessionId ? t('chat.clickToEditTitle') : undefined}\n              >\n                {displayTitle}\n              </div>\n            )}\n          <div className='chat-header-subtitle'>\n            {cwd || t('chat.selectModel')}\n          </div>\n        </div>\n      </div>\n\n      {sessionId && (\n        <div\n          className='chat-header-session-id'\n          onDoubleClick={() => {\n            navigator.clipboard.writeText(sessionId)\n            message.success('Session ID 已复制到剪贴板')\n            console.log('[ChatHeader] Session Info:', {\n              id: sessionId,\n              title,\n              cwd,\n              sessionInfo\n            })\n          }}\n          title='双击复制 Session ID 并打印详情'\n        >\n          {sessionId}\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/CodeBlock.tsx","messages":[{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":17,"column":5,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":41,"endColumn":7,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[332,332],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[332,332],"text":"await "},"desc":"Add await operator."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react'\nimport { codeToHtml } from 'shiki'\n\nexport function CodeBlock({\n  code,\n  lang = 'json',\n  showLineNumbers = false\n}: {\n  code: string\n  lang?: string\n  showLineNumbers?: boolean\n}) {\n  const [html, setHtml] = useState<string>('')\n\n  useEffect(() => {\n    let isMounted = true\n    codeToHtml(code, {\n      lang,\n      theme: 'github-light',\n      transformers: showLineNumbers\n        ? [\n          {\n            name: 'line-numbers',\n            line(node, line) {\n              node.children.unshift({\n                type: 'element',\n                tagName: 'span',\n                properties: {\n                  class: 'line-number',\n                  style:\n                    'display: inline-block; width: 2rem; margin-right: 1rem; text-align: right; color: #9ca3af; user-select: none;'\n                },\n                children: [{ type: 'text', value: String(line) }]\n              })\n            }\n          }\n        ]\n        : []\n    }).then(h => {\n      if (isMounted) setHtml(h)\n    })\n    return () => {\n      isMounted = false\n    }\n  }, [code, lang, showLineNumbers])\n\n  if (!html) {\n    return (\n      <pre style={{ margin: 0, fontSize: 12, color: '#4b5563' }}>\n        <code>{code}</code>\n      </pre>\n    )\n  }\n\n  return <div dangerouslySetInnerHTML={{ __html: html }} />\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/CompletionMenu.tsx","messages":[{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":46,"column":14,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":46,"endColumn":23,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[1075,1084],"text":"(item.icon != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[1075,1084],"text":"(item.icon ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[1075,1084],"text":"(Boolean(item.icon))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":49,"column":16,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":49,"endColumn":32,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[1270,1286],"text":"(item.description != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[1270,1286],"text":"(item.description ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[1270,1286],"text":"(Boolean(item.description))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './CompletionMenu.scss'\nimport React, { useEffect, useRef } from 'react'\n\nexport interface CompletionItem {\n  label: string\n  value: string\n  description?: string\n  icon?: string\n}\n\ninterface CompletionMenuProps {\n  items: CompletionItem[]\n  onSelect: (item: CompletionItem) => void\n  onClose: () => void\n  selectedIndex: number\n}\n\nexport function CompletionMenu({\n  items,\n  onSelect,\n  selectedIndex\n}: CompletionMenuProps) {\n  const menuRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const activeItem = menuRef.current?.querySelector('.active')\n    if (activeItem) {\n      activeItem.scrollIntoView({ block: 'nearest' })\n    }\n  }, [selectedIndex])\n\n  if (items.length === 0) return null\n\n  return (\n    <div\n      ref={menuRef}\n      className='completion-menu'\n    >\n      <div className='completion-menu-content'>\n        {items.map((item, index) => (\n          <div\n            key={item.value}\n            className={`completion-item ${index === selectedIndex ? 'active' : ''}`}\n            onClick={() => onSelect(item)}\n          >\n            {item.icon && <span className='material-symbols-outlined icon'>{item.icon}</span>}\n            <div className='item-info'>\n              <span className='label'>{item.label}</span>\n              {item.description && <span className='description'>{item.description}</span>}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/CurrentTodoList.tsx","messages":[{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":24,"column":9,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":24,"endColumn":10},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected any value in conditional. An explicit comparison or type conversion is required.","line":26,"column":53,"nodeType":"MemberExpression","messageId":"conditionErrorAny","endLine":26,"endColumn":66,"suggestions":[{"messageId":"conditionFixCastBoolean","fix":{"range":[876,889],"text":"(Boolean(todoUse.input))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './CurrentTodoList.scss'\nimport type { ChatMessage } from '@vibe-forge/core'\nimport React, { useState } from 'react'\nimport { useTranslation } from 'react-i18next'\n\ninterface TodoItem {\n  id: string\n  content: string\n  status: 'pending' | 'in_progress' | 'completed'\n  priority: string\n}\n\nexport function CurrentTodoList({ messages }: { messages: ChatMessage[] }) {\n  const { t } = useTranslation()\n  const [isExpanded, setIsExpanded] = useState(false)\n\n  // Find the latest TodoWrite tool use\n  let latestTodos: TodoItem[] = []\n\n  for (let i = messages.length - 1; i >= 0; i--) {\n    const msg = messages[i]\n    if (msg.role === 'assistant' && Array.isArray(msg.content)) {\n      const todoUse = msg.content.find(c =>\n        c && c.type === 'tool_use' && (c.name === 'TodoWrite' || c.name === 'todo_write')\n      )\n      if (todoUse && todoUse.type === 'tool_use' && todoUse.input && typeof todoUse.input === 'object') {\n        const input = todoUse.input as { todos?: TodoItem[] }\n        if (Array.isArray(input.todos)) {\n          latestTodos = input.todos\n          break\n        }\n      }\n    }\n  }\n\n  if (latestTodos.length === 0) return null\n\n  const completedCount = latestTodos.filter(t => t.status === 'completed').length\n  const totalCount = latestTodos.length\n\n  if (totalCount === 0) {\n    return (\n      <div className='current-todo-container empty'>\n        <div className='todo-progress-bar empty'>\n          <div className='progress-info'>\n            <span className='material-symbols-outlined'>assignment_late</span>\n            <span className='text'>{t('chat.todo.noTasks')}</span>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className={`current-todo-container ${isExpanded ? 'expanded' : ''}`}>\n      <div className='todo-progress-bar' onClick={() => setIsExpanded(!isExpanded)}>\n        <div className='progress-info'>\n          <span className='material-symbols-outlined'>assignment</span>\n          <span className='text'>{t('chat.todo.progress', { completed: completedCount, total: totalCount })}</span>\n        </div>\n        <div className='progress-track'>\n          <div\n            className='progress-fill'\n            style={{ width: `${(completedCount / totalCount) * 100}%` }}\n          />\n        </div>\n        <button className='expand-btn'>\n          <span className='material-symbols-outlined'>\n            {isExpanded ? 'expand_more' : 'expand_less'}\n          </span>\n        </button>\n      </div>\n\n      {isExpanded && (\n        <div className='todo-items-overlay'>\n          <div className='todo-items-scroll-container'>\n            {latestTodos.map((todo, idx) => (\n              <div\n                key={todo.id || idx}\n                className={`todo-item-vertical status-${todo.status}`}\n              >\n                <span className='material-symbols-outlined icon'>\n                  {todo.status === 'completed'\n                    ? 'check_circle'\n                    : todo.status === 'in_progress'\n                    ? 'clock_loader_40'\n                    : 'radio_button_unchecked'}\n                </span>\n                <div className='todo-content-wrapper'>\n                  <span className='text'>{todo.content}</span>\n                  {todo.priority && <span className={`priority-tag ${todo.priority}`}>{todo.priority}</span>}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/MessageItem.tsx","messages":[{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected value in conditional. A boolean expression is required.","line":25,"column":10,"nodeType":"MemberExpression","messageId":"conditionErrorOther","endLine":25,"endColumn":21},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":43,"column":12,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":43,"endColumn":16},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":53,"column":28,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":53,"endColumn":39},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":56,"column":17,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":56,"endColumn":24},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":57,"column":55,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":57,"endColumn":56},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":63,"column":17,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":63,"endColumn":24},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":80,"column":22,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":80,"endColumn":23},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":82,"column":35,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":82,"endColumn":46},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":84,"column":13,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":84,"endColumn":20},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected object value in conditional. The condition is always true.","line":85,"column":42,"nodeType":"Identifier","messageId":"conditionErrorObject","endLine":85,"endColumn":43},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":110,"column":19,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":110,"endColumn":34,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[3390,3405],"text":"(msg.toolCall.id != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[3390,3405],"text":"(msg.toolCall.id ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[3390,3405],"text":"(Boolean(msg.toolCall.id))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected any value in conditional. An explicit comparison or type conversion is required.","line":114,"column":25,"nodeType":"MemberExpression","messageId":"conditionErrorAny","endLine":114,"endColumn":44,"suggestions":[{"messageId":"conditionFixCastBoolean","fix":{"range":[3536,3555],"text":"(Boolean(msg.toolCall.output))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":117,"column":30,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":117,"endColumn":45,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[3640,3655],"text":"(msg.toolCall.id != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[3640,3655],"text":"(msg.toolCall.id ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[3640,3655],"text":"(Boolean(msg.toolCall.id))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":129,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":129,"endColumn":16,"suggestions":[{"fix":{"range":[3904,3939],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"ts/strict-boolean-expressions","severity":2,"message":"Unexpected nullable string value in conditional. Please handle the nullish/empty cases explicitly.","line":143,"column":22,"nodeType":"MemberExpression","messageId":"conditionErrorNullableString","endLine":143,"endColumn":31,"suggestions":[{"messageId":"conditionFixCompareNullish","fix":{"range":[4300,4309],"text":"(msg.model != null)"},"desc":"Change condition to check for null/undefined (`value != null`)"},{"messageId":"conditionFixDefaultEmptyString","fix":{"range":[4300,4309],"text":"(msg.model ?? \"\")"},"desc":"Explicitly treat nullish value the same as an empty string (`value ?? \"\"`)"},{"messageId":"conditionFixCastBoolean","fix":{"range":[4300,4309],"text":"(Boolean(msg.model))"},"desc":"Explicitly convert value to a boolean (`Boolean(value)`)"}]},{"ruleId":"ts/no-floating-promises","severity":2,"message":"Promises must be awaited, end with a call to .catch, end with a call to .then with a rejection handler or be explicitly marked as ignored with the `void` operator.","line":156,"column":15,"nodeType":"ExpressionStatement","messageId":"floatingVoid","endLine":156,"endColumn":83,"suggestions":[{"messageId":"floatingFixVoid","fix":{"range":[4714,4714],"text":"void "},"desc":"Add void operator to ignore."},{"messageId":"floatingFixAwait","fix":{"range":[4714,4714],"text":"await "},"desc":"Add await operator."}]}],"suppressedMessages":[],"errorCount":16,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './MessageItem.scss'\nimport type { ChatMessage, ChatMessageContent } from '@vibe-forge/core'\nimport { message } from 'antd'\nimport React from 'react'\nimport { useTranslation } from 'react-i18next'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { ToolRenderer } from './ToolRenderer'\n\nexport function MessageItem({\n  msg,\n  isFirstInGroup,\n  allMessages,\n  index\n}: {\n  msg: ChatMessage\n  isFirstInGroup: boolean\n  allMessages: ChatMessage[]\n  index: number\n}) {\n  const { t } = useTranslation()\n  const isUser = msg.role === 'user'\n\n  const renderContent = () => {\n    if (!msg.content) return null\n\n    if (typeof msg.content === 'string') {\n      return (\n        <div className='markdown-body'>\n          <ReactMarkdown remarkPlugins={[remarkGfm]}>\n            {msg.content}\n          </ReactMarkdown>\n        </div>\n      )\n    }\n\n    if (!Array.isArray(msg.content)) return null\n\n    const renderedItems: React.ReactNode[] = []\n    let i = 0\n    while (i < msg.content.length) {\n      const item = msg.content[i]\n      if (!item) {\n        i++\n        continue\n      }\n\n      if (item.type === 'tool_use') {\n        let resultItem = msg.content.find((r, idx) =>\n          idx > i && r.type === 'tool_result' && r.tool_use_id === item.id\n        ) as Extract<ChatMessageContent, { type: 'tool_result' }> | undefined\n\n        if (!resultItem && allMessages) {\n          for (let j = index + 1; j < allMessages.length; j++) {\n            const nextMsg = allMessages[j]\n            if (nextMsg && Array.isArray(nextMsg.content)) {\n              const found = nextMsg.content.find(r => r && r.type === 'tool_result' && r.tool_use_id === item.id)\n              if (found) {\n                resultItem = found as Extract<ChatMessageContent, { type: 'tool_result' }>\n                break\n              }\n            }\n            if (nextMsg && nextMsg.role === 'assistant') break\n          }\n        }\n\n        renderedItems.push(\n          <ToolRenderer key={item.id || i} item={item} resultItem={resultItem} />\n        )\n      } else if (item.type === 'text') {\n        renderedItems.push(\n          <div key={i} className='markdown-body'>\n            <ReactMarkdown remarkPlugins={[remarkGfm]}>\n              {item.text}\n            </ReactMarkdown>\n          </div>\n        )\n      } else if (item.type === 'tool_result') {\n        const hasCallInCurrent = msg.content.some((c, idx) =>\n          idx < i && c && c.type === 'tool_use' && c.id === item.tool_use_id\n        )\n        const hasCallInPrevious = allMessages\n          && allMessages.slice(0, index).some(prevMsg =>\n            prevMsg && Array.isArray(prevMsg.content)\n            && prevMsg.content.some(c => c && c.type === 'tool_use' && c.id === item.tool_use_id)\n          )\n\n        if (!hasCallInCurrent && !hasCallInPrevious) {\n          renderedItems.push(\n            <ToolRenderer\n              key={item.tool_use_id || i}\n              item={{ type: 'tool_use', id: item.tool_use_id, name: t('chat.tools.unknown'), input: {} }}\n              resultItem={item}\n            />\n          )\n        }\n      }\n      i++\n    }\n\n    if (renderedItems.length === 0) return null\n\n    return (\n      <div className='message-contents'>\n        {renderedItems}\n        {msg.toolCall && (\n          <ToolRenderer\n            item={{\n              type: 'tool_use',\n              id: msg.toolCall.id || 'legacy',\n              name: msg.toolCall.name,\n              input: msg.toolCall.args\n            }}\n            resultItem={msg.toolCall.output\n              ? {\n                type: 'tool_result',\n                tool_use_id: msg.toolCall.id || 'legacy',\n                content: msg.toolCall.output,\n                is_error: msg.toolCall.status === 'error'\n              }\n              : undefined}\n          />\n        )}\n      </div>\n    )\n  }\n\n  const handleDoubleClick = () => {\n    console.log('[Message Data]:', msg)\n  }\n\n  const content = renderContent()\n  if (!content) return null\n\n  return (\n    <div\n      className={`${isUser ? 'chat-message-user' : 'chat-message-assistant'} ${!isFirstInGroup ? 'consecutive' : ''}`}\n      onDoubleClick={handleDoubleClick}\n    >\n      <div className='bubble'>\n        {content}\n        <div className='msg-footer'>\n          {isUser && msg.model && (\n            <span className='msg-model'>\n              {msg.model.split(',').pop()}\n            </span>\n          )}\n          {isUser && msg.usage && (\n            <span className='msg-usage'>\n              Tokens: {msg.usage.input_tokens + msg.usage.output_tokens}\n            </span>\n          )}\n          <span\n            className='timestamp'\n            onDoubleClick={() => {\n              navigator.clipboard.writeText(new Date(msg.createdAt).toISOString())\n              message.success('ISO 时间已复制到剪贴板')\n            }}\n            title='双击复制 ISO 时间'\n          >\n            {new Date(msg.createdAt).toLocaleString('zh-CN', {\n              year: 'numeric',\n              month: '2-digit',\n              day: '2-digit',\n              hour: '2-digit',\n              minute: '2-digit',\n              second: '2-digit',\n              hour12: false\n            })}\n          </span>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/Sender.tsx","messages":[{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":92,"column":36,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":92,"endColumn":53},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":93,"column":50,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":93,"endColumn":67},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":106,"column":53,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":70},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":108,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":108,"endColumn":59},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":119,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":119,"endColumn":49},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":120,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":120,"endColumn":63},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":129,"column":30,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":47},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":130,"column":42,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":59},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":143,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":143,"endColumn":49},{"ruleId":"ts/no-unsafe-member-access","severity":2,"message":"Unsafe member access .resizableTextArea on an `any` value.","line":144,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":144,"endColumn":63}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import './Sender.scss'\nimport type { SessionInfo } from '@vibe-forge/core'\nimport { Input, Tooltip, message } from 'antd'\nimport React, { useEffect, useRef, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport type { CompletionItem } from './CompletionMenu'\nimport { CompletionMenu } from './CompletionMenu'\nimport { ThinkingStatus } from './ThinkingStatus'\n\nconst { TextArea } = Input\n\nexport function Sender({\n  onSend,\n  isThinking,\n  onInterrupt,\n  onClear,\n  sessionInfo\n}: {\n  onSend: (text: string) => void\n  isThinking: boolean\n  onInterrupt: () => void\n  onClear?: () => void\n  sessionInfo?: SessionInfo | null\n}) {\n  const { t } = useTranslation()\n  const [input, setInput] = useState('')\n  const [showCompletion, setShowCompletion] = useState(false)\n  const [completionItems, setCompletionItems] = useState<CompletionItem[]>([])\n  const [selectedIndex, setSelectedIndex] = useState(0)\n  const [triggerChar, setTriggerChar] = useState<string | null>(null)\n\n  const [showToolsList, setShowToolsList] = useState(false)\n  const textareaRef = useRef<any>(null)\n  const toolsRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (toolsRef.current && !toolsRef.current.contains(event.target as Node)) {\n        setShowToolsList(false)\n      }\n    }\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [])\n\n  const [historyIndex, setHistoryIndex] = useState(-1)\n  const [draft, setDraft] = useState('')\n\n  const handleSend = () => {\n    if (input.trim() === '' || isThinking) return\n    onSend(input)\n\n    // Save to local storage history\n    try {\n      const history = JSON.parse(localStorage.getItem('vf_chat_history') ?? '[]') as string[]\n      const newHistory = [input, ...history.filter((h: string) => h !== input)].slice(0, 50)\n      localStorage.setItem('vf_chat_history', JSON.stringify(newHistory))\n    } catch (e) {\n      console.error('Failed to save chat history', e)\n    }\n\n    setInput('')\n    setDraft('')\n    setShowCompletion(false)\n    setHistoryIndex(-1)\n  }\n\n  const handleHistoryNavigation = (direction: 'up' | 'down') => {\n    try {\n      const history = JSON.parse(localStorage.getItem('vf_chat_history') ?? '[]') as string[]\n      if (history.length === 0) return\n\n      let nextIndex = historyIndex\n      if (direction === 'up') {\n        nextIndex = Math.min(historyIndex + 1, history.length - 1)\n      } else {\n        nextIndex = Math.max(historyIndex - 1, -1)\n      }\n\n      if (nextIndex !== historyIndex) {\n        // Save draft when leaving -1\n        if (historyIndex === -1) {\n          setDraft(input)\n        }\n\n        setHistoryIndex(nextIndex)\n        const nextValue = nextIndex === -1 ? draft : history[nextIndex]\n        setInput(nextValue)\n\n        // Set cursor to the end of the text\n        setTimeout(() => {\n          if (textareaRef.current?.resizableTextArea?.textArea != null) {\n            const textArea = textareaRef.current.resizableTextArea.textArea as HTMLTextAreaElement\n            const length = nextValue.length\n            textArea.setSelectionRange(length, length)\n            textArea.focus()\n          }\n        }, 0)\n      }\n    } catch (e) {\n      console.error('Failed to navigate chat history', e)\n    }\n  }\n\n  const handleSelectCompletion = (item: CompletionItem) => {\n    if (triggerChar == null || textareaRef.current?.resizableTextArea?.textArea == null) return\n\n    const textArea = textareaRef.current.resizableTextArea.textArea as HTMLTextAreaElement\n    const cursorFallback = textArea.selectionStart\n    const textBeforeTrigger = input.slice(0, input.lastIndexOf(triggerChar, cursorFallback - 1))\n    const textAfterCursor = input.slice(cursorFallback)\n\n    const newValue = `${textBeforeTrigger}${triggerChar}${item.value} ${textAfterCursor}`\n    setInput(newValue)\n    setShowCompletion(false)\n\n    // Focus back and set cursor\n    setTimeout(() => {\n      if (textareaRef.current?.resizableTextArea?.textArea != null) {\n        const textArea = textareaRef.current.resizableTextArea.textArea as HTMLTextAreaElement\n        const newCursorPos = textBeforeTrigger.length + triggerChar.length + item.value.length + 1\n        textArea.focus()\n        textArea.setSelectionRange(newCursorPos, newCursorPos)\n      }\n    }, 0)\n  }\n\n  const handleTriggerClick = (char: string) => {\n    if (textareaRef.current?.resizableTextArea?.textArea == null) return\n    const textArea = textareaRef.current.resizableTextArea.textArea as HTMLTextAreaElement\n    const cursor = textArea.selectionStart\n    const textBefore = input.slice(0, cursor)\n    const textAfter = input.slice(cursor)\n\n    // Check if we need to add a space before the trigger char\n    const needsSpaceBefore = textBefore.length > 0 && !textBefore.endsWith(' ')\n    const trigger = needsSpaceBefore ? ` ${char}` : char\n\n    const newValue = textBefore + trigger + textAfter\n    setInput(newValue)\n\n    setTimeout(() => {\n      if (textareaRef.current?.resizableTextArea?.textArea != null) {\n        const textArea = textareaRef.current.resizableTextArea.textArea as HTMLTextAreaElement\n        const newPos = cursor + trigger.length\n        textArea.focus()\n        textArea.setSelectionRange(newPos, newPos)\n\n        // Trigger handleInputChange logic manually\n        const event = { target: textArea } as unknown as React.ChangeEvent<HTMLTextAreaElement>\n        handleInputChange(event)\n      }\n    }, 0)\n  }\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (showCompletion) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault()\n        setSelectedIndex(prev => (prev + 1) % completionItems.length)\n        return\n      }\n      if (e.key === 'ArrowUp') {\n        e.preventDefault()\n        setSelectedIndex(prev => (prev - 1 + completionItems.length) % completionItems.length)\n        return\n      }\n      if (e.key === 'Enter' || e.key === 'Tab') {\n        e.preventDefault()\n        const selectedItem = completionItems[selectedIndex]\n        if (selectedItem != null) {\n          handleSelectCompletion(selectedItem)\n        }\n        return\n      }\n      if (e.key === 'Escape') {\n        e.preventDefault()\n        setShowCompletion(false)\n        return\n      }\n    }\n\n    // History navigation logic\n    if (e.key === 'ArrowUp') {\n      const textarea = e.target as HTMLTextAreaElement\n      const cursorPosition = textarea.selectionStart\n      const textBeforeCursor = textarea.value.substring(0, cursorPosition)\n\n      // Only navigate if cursor is at the first line\n      if (!textBeforeCursor.includes('\\n')) {\n        const historyJson = localStorage.getItem('vf_chat_history')\n        const history = (historyJson != null ? JSON.parse(historyJson) : []) as string[]\n        const currentHistoryValue = historyIndex === -1 ? null : history[historyIndex]\n\n        // If content is empty OR content matches the current history entry, allow navigation\n        if (input.trim() === '' || input === currentHistoryValue) {\n          e.preventDefault()\n          handleHistoryNavigation('up')\n          return\n        }\n      }\n    }\n\n    if (e.key === 'ArrowDown') {\n      const textarea = e.target as HTMLTextAreaElement\n      const cursorPosition = textarea.selectionEnd\n      const textAfterCursor = textarea.value.substring(cursorPosition)\n\n      // Only navigate if cursor is at the last line\n      if (!textAfterCursor.includes('\\n')) {\n        const historyJson = localStorage.getItem('vf_chat_history')\n        const history = (historyJson != null ? JSON.parse(historyJson) : []) as string[]\n        const currentHistoryValue = historyIndex === -1 ? null : history[historyIndex]\n\n        // If history navigation has started (index >= 0) OR content matches current history entry\n        if (historyIndex !== -1 || input === currentHistoryValue) {\n          e.preventDefault()\n          handleHistoryNavigation('down')\n          return\n        }\n      }\n    }\n\n    // More shortcuts\n    if (e.key === 'Escape') {\n      if (input !== '') {\n        e.preventDefault()\n        setInput('')\n        setHistoryIndex(-1)\n      }\n      return\n    }\n\n    // Cmd/Ctrl + K to clear screen\n    if (e.key === 'k' && (e.metaKey || e.ctrlKey)) {\n      e.preventDefault()\n      setInput('')\n      setHistoryIndex(-1)\n      if (onClear != null) {\n        onClear()\n      } else {\n        void message.info('Clear screen is not supported in this context')\n      }\n      return\n    }\n\n    // Cmd/Ctrl + Enter to send\n    if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n      e.preventDefault()\n      handleSend()\n    }\n  }\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const value = e.target.value\n    setInput(value)\n\n    const cursor = e.target.selectionStart\n    const charBeforeCursor = value[cursor - 1]\n\n    if (['/', '@', '#'].includes(charBeforeCursor)) {\n      setTriggerChar(charBeforeCursor)\n      let items: CompletionItem[] = []\n\n      if (sessionInfo?.type === 'init') {\n        const info = sessionInfo\n        if (charBeforeCursor === '/') {\n          items = (info.slashCommands != null ? info.slashCommands : []).map(cmd => ({\n            label: `/${cmd}`,\n            value: cmd,\n            icon: 'terminal'\n          }))\n        } else if (charBeforeCursor === '@') {\n          items = (info.agents != null ? info.agents : []).map(agent => ({\n            label: `@${agent}`,\n            value: agent,\n            icon: 'smart_toy'\n          }))\n        } else if (charBeforeCursor === '#') {\n          items = (info.tools != null ? info.tools : []).map(tool => ({\n            label: `#${tool}`,\n            value: tool,\n            icon: 'check_box'\n          }))\n        }\n      }\n\n      if (items.length > 0) {\n        setCompletionItems(items)\n        setSelectedIndex(0)\n        setShowCompletion(true)\n      } else {\n        setShowCompletion(false)\n      }\n    } else if (showCompletion) {\n      // Filter logic could go here if needed\n      if (!value.includes(triggerChar ?? '')) {\n        setShowCompletion(false)\n      }\n    }\n  }\n\n  return (\n    <div className='chat-input-wrapper'>\n      {isThinking && <ThinkingStatus />}\n      <div className='chat-input-container'>\n        {showCompletion && (\n          <CompletionMenu\n            items={completionItems}\n            selectedIndex={selectedIndex}\n            onSelect={handleSelectCompletion}\n            onClose={() => setShowCompletion(false)}\n          />\n        )}\n        <TextArea\n          ref={textareaRef}\n          className='chat-input-textarea'\n          placeholder={t('chat.inputPlaceholder')}\n          value={input}\n          onChange={handleInputChange}\n          onKeyDown={handleKeyDown}\n          autoSize={{ minRows: 1, maxRows: 10 }}\n          variant='borderless'\n        />\n\n        <div className='chat-input-toolbar'>\n          <div className='toolbar-left'>\n            <Tooltip title='快捷指令'>\n              <div className='toolbar-btn' onClick={() => handleTriggerClick('/')}>\n                <span className='material-symbols-outlined'>terminal</span>\n              </div>\n            </Tooltip>\n            <Tooltip title='提及代理'>\n              <div className='toolbar-btn' onClick={() => handleTriggerClick('@')}>\n                <span className='material-symbols-outlined'>smart_toy</span>\n              </div>\n            </Tooltip>\n            <Tooltip title='注入上下文'>\n              <div className='toolbar-btn' onClick={() => handleTriggerClick('#')}>\n                <span className='material-symbols-outlined'>description</span>\n              </div>\n            </Tooltip>\n            <Tooltip title='上传图片'>\n              <div className='toolbar-btn' onClick={() => void message.info('图片上传功能尚不支持')}>\n                <span className='material-symbols-outlined'>image</span>\n              </div>\n            </Tooltip>\n\n            {sessionInfo != null && sessionInfo.type === 'init' && (\n              <div className='session-info-toolbar' ref={toolsRef}>\n                <div\n                  className={`info-item ${showToolsList ? 'active' : ''}`}\n                  onClick={() => setShowToolsList(!showToolsList)}\n                >\n                  <span className='material-symbols-outlined'>build</span>\n                  <span className='info-text'>{t('chat.toolsCount', { count: sessionInfo.tools.length })}</span>\n                  <span className='material-symbols-outlined arrow-icon'>keyboard_arrow_up</span>\n                </div>\n\n                {showToolsList && (\n                  <div className='tools-list-popup'>\n                    <div className='popup-header'>{t('chat.availableTools')}</div>\n                    <div className='popup-content'>\n                      <div className='tools-list'>\n                        {sessionInfo.tools.map(tool => (\n                          <div key={tool} className='tool-item'>\n                            <span className='material-symbols-outlined'>check_circle</span>\n                            <span className='tool-name'>{tool}</span>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n\n          <div className='toolbar-right'>\n            <Tooltip title='切换模型'>\n              <div className='toolbar-btn model-switcher' onClick={() => void message.info('模型切换功能尚不支持')}>\n                <span className='material-symbols-outlined'>variable_insert</span>\n                <span className='model-name'>\n                  {(sessionInfo?.type === 'init' ? sessionInfo.model : null) ?? 'GPT-4o'}\n                </span>\n                <span className='material-symbols-outlined arrow'>keyboard_arrow_down</span>\n              </div>\n            </Tooltip>\n\n            <div\n              className={`chat-send-btn ${input.trim() !== '' ? 'active' : ''} ${isThinking ? 'thinking' : ''}`}\n              onClick={isThinking ? onInterrupt : handleSend}\n            >\n              <span className='material-symbols-outlined'>\n                {isThinking ? 'stop_circle' : 'send'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className='chat-input-hint'>\n        {t('chat.hint')}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/ThinkingStatus.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/ToolCallBox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/ToolRenderer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/tools/BashTool.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/tools/DefaultTool.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/tools/ReadTool.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/tools/TodoTool.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/chat/tools/WriteTool.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/sidebar/SessionItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/sidebar/SessionList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/components/sidebar/SidebarHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/i18n.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/resources/locales/en.json","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/resources/locales/zh.json","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/bytedance/projects/vibe-forge.ai/apps/web/src/ws.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
